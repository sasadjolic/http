(function(g){g("http",[],function(g){Promise||(Promise=g("promise"));"undefined"===typeof window&&(window={});var d=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}return!1},k=function(b,a){for(prop in a)"object"==typeof a[prop]?k(b[prop],a[prop]):b[prop]=a[prop]},n=function(b){var a=0;if("boolean"===typeof b)a=4;else if("string"===typeof b)a=2*b.length;else if("number"===
typeof b)a=8;else if("object"===typeof b)for(i in b)a+=8,a+=n(b[i]);return a},l=0,m=[],p=function(b,a){var e=b+" "+a,h=m[e];h&&h.response.expires&&0>=h.response.expires.getTime()-(new Date).getTime()&&(l-=h.size,m.splice(m.indexOf(e),1),h=null);return h},q=function(b){var a=b.getResponseHeader("cache-control");if(a){if(-1<a.indexOf("no-cache"))return"";if((a=a.match(/max-?age\s*=\s*(\d+)/))&&0<a[1])return b=a[1],a=new Date,a.setTime(a.getTime()+1E3*b),a}if(a=b.getResponseHeader("expires"))return new Date(a);
a=new Date;a.setTime(a.getTime()+e._options.cache.age);return a},c=null,e=function(){if(null!==c)throw Error("Can't instantiate more than one HTTP instance");},f=function(b,a,f,h,g){var k=new Promise(function(g,k){var c=p(b,a,f,h);if(c)g(c.response);else{var j=d();j.open(b,a,!0);for(var o in f)j.setRequestHeader(o,f[o]);j.onreadystatechange=function(){if(4==j.readyState){clearTimeout(r);var c={};c.status=j.status;c.body=j.responseText;c.headers=(j.getAllResponseHeaders()||"").trim().split("\n");c.expires=
q(j);if(0<c.status){var d={request:{method:b,url:a,headers:f,body:h},response:c};d.size=n(d);l+d.size<=e._options.cache.size&&(m[b+" "+a]=d,l+=d.size);g(c)}else k(Error("XMLHTTPRequest error"))}};var r=setTimeout(function(){j.abort()},e._options.timeout);j.send(h)}});if(!g)return k;k.then(function(a){g(null,a.status,a.headers,a.body)})};e.prototype={request:f,get:function(b,a){return f("GET",b.url,b.headers,void 0,a)},post:function(b,a){return f("POST",b.url,b.headers,b.body,a)},put:function(b,a){return f("PUT",
b.url,b.headers,b.body,a)},patch:function(b,a){return f("PATCH",b.url,b.headers,b.body,a)},del:function(b,a){return f("DELETE",b.url,b.headers,void 0,a)},options:function(b){k(e._options,b);return e._options}};e._options={cache:{enabled:!1,methods:["GET"],age:864E5,size:104857600},log:!1,timeout:6E4};null===c&&(c=new e);return c})})("function"===typeof define&&define.amd?define:function(g,s,d){"undefined"!==typeof module&&module.exports?module.exports=d(require):window.http="function"===typeof require?
d(function(d){return window[d]}):d()});
